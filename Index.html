<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>BackManager-Index</title>
    <link href="doc/css/index.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript" src="common/Icarus.js"></script>
    <script type="text/javascript" src="libs/jquery-3.2.1.min.js"></script>
    <script type="text/javascript">
        function showmenu(id){
            var list=document.getElementById("list"+id);
            var menu=document.getElementById("menu"+id);
            if(list.style.display=="none"){
                document.getElementById("list"+id).style.display="block";
            }
            else{
                document.getElementById("list"+id).style.display="none";
            }
        }
        function query() {
            var id = document.getElementById("txt1").value;
            $.ajax({
                type: 'post',
                xhrFields: {
                    withCredentials: true
                },
                url: 'http://115.159.56.141/index.php/Admin/User/getOneUser',
                data: {username: id},
                dataType: 'json',
                success: function (data) {
                    document.getElementById("nick").value = data.data[0].user_nick;
                    document.getElementById("email").value = data.data[0].email;
                    document.getElementById("ltimes").value = data.data[0].login_times;
                    var statu = data.data[0].is_seal;
                    if(statu == 0){document.getElementById("seal").value = "正常";}
                    else{document.getElementById("seal").value = "封号";}
                    var num = data.data[0].is_admin;
                    if(num == 0){document.getElementById("identy").value = "普通用户";}
                    else if(num == 1){document.getElementById("identy").value = "版主";}
                    else if(num == 2){document.getElementById("identy").value = "用户管理员";}
                    else{document.getElementById("identy").value = "超级管理员";}
                }
            });
        }
        function showfun(id){
            var content = document.getElementById("fun"+id);
            if(content.style.display == "none"){
                document.getElementById("fun"+id).style.display="block";
            }
            else{
                document.getElementById("fun"+id).style.display="none";
            }
        }

        $(document).ready(function () {
            $("#clist").click(function () {
                $.ajax({
                    type: 'get',
                    xhrFields: {
                        withCredentials: true
                    },
                    url: 'http://115.159.56.141/index.php/Admin/Classification/getParentClassificationList',

                    cache: false,
                    dataType: 'json',
                    success:secgetData


                });
            });
        });
        $(document).ready(function () {

                $.ajax({
                    type: 'get',
                    xhrFields: {
                        withCredentials: true
                    },
                    url: 'http://115.159.56.141/index.php/Admin/User/getUserCount',
                    cache: false,
                    dataType: 'json',
                    success: getUserCount
                });

        });

         function getUserCount(data){
             console.log(Math.ceil(data.data.count/5));
             var page=Math.ceil(data.data.count/5);
           return o={
               page:page,
               row:'5'
           }

         }

         function secgetData(data)
             {


                 $(".cardlist").append('<tr>' +
                     '<th>父分类名称</th>' +
                     '<th>分类id</th>' +

                         '<th>是否加入精选</th>'+
                      ' </tr>');

                 for (var key in data.data) {
                     $(".cardlist").append('<tr>' +
                         '<td>' + data.data[key].c_name + '</td>' +
                         '<td>' + data.data[key].cid + '</td>' +

                         '<td>' + data.data[key].is_featured + '</td>' +
                          ' </tr>');}
                 $(".cardlist").append('<a href="look.html" id="lookfor">点击查看</a>');

                 //请输入要查看的父板块<input type="text" id="calltree"/>


        }


                $('.lookfor').on('click',function () {
                    $.ajax({
                        type: 'get',
                        xhrFields: {
                            withCredentials: true
                        },
                        url:'http://115.159.56.141/index.php/Admin/Classification/getTreeClassification',
                        data:getfatherCid,
                        dataType: 'json',
                        success:showchild
                    });
                })


        function getData(data) {
            $(".imagetable").append('<tr>' +
                '<th>用户名</th>' +
                '<th>昵称</th>' +
                '<th>创建时间</th>' +
                '<th>最后登陆时间</th>' +
                '<th>最后登录ip</th>' +
                '<th>登录次数</th>' +
                '<th>邮箱</th>' +
                '<th>用户类型</th>' +
                '<th>封号</th>' +
                '<th>版主</th>' +
                + ' </tr>');

            for (var key in data.data) {
                $(".imagetable").append('<tr>' +
                    '<td>' + data.data[key].username + '</td>' +
                    '<td>' + data.data[key].user_nick + '</td>' +
                    '<td>' + data.data[key].create_time + '</td>' +
                    '<td>' + data.data[key].last_login_time + '</td>' +
                    '<td>' + data.data[key].last_login_ip + '</td>' +
                    '<td>' + data.data[key].login_times + '</td>' +
                    '<td>' + data.data[key].email + '</td>' +
                    '<td>' + data.data[key].is_admin + '</td>' +
                    '<td>' + data.data[key].is_seal + '</td>' +
                    '<td>' + data.data[key].cid + '</td>' +
                    + ' </tr>');}
         /*    function  addButton(o) {
                var before = o.page-1;
                 $(".imagetable").append('<button id="before"><a href="http://115.159.56.141/Admin/User/getUserList?page=' + before + '&row=5">前一页</a></button>');
                 for(var i=1;i<o.page+1;i++)
                 {
                     $(".imagetable").append('<button id="add"'+ i + '><a href="useradjust.html">' + i + '</a></button>');
                 }
                 $(".imagetable").append('<button id="after"><a href="useradjust.html">后一页</a></button>');
             }

            addButton(o);
*/

            $(".imagetable").append('<a href="useradjust.html" id="uesradjust">用户身份调整</a>');
        }


        $(document).ready(function () {
            $("#list").click(function () {
                $.ajax({
                    type: 'get',
                    xhrFields: {
                        withCredentials: true
                    },
                    url: 'http://115.159.56.141/index.php/Admin/User/getUserList',
                    data:o,
                    cache: false,
                    dataType: 'json',
                    success: getData
                });
            });
        });

        //<button id="addi"><a href="#">i</a></button>

    </script>

</head>
<body>
<div id="page-container">
    <div id="header">
        <h1>后台管理系统</h1>
        <a href="#">返回首页</a>
        <a href="#">修改密码</a>
        <a href="#">退出系统</a>
    </div>
    <div id="sidebar-a">
        <table class="imagetable">
        </table>
        <table class="cardlist">
        </table>
        <table class="cardtree">
        </table>
    </div>



    <div id="content">
        <div id="nav">
           <div><input type="button" value="用户管理" class="title" id="menu1" onclick="showmenu('1')"/></div>
               <div id="list1"  style="display: none">
                    <ul class="option">

                        <li><a href="#" id="list">用户列表</a></li>

                    </ul>
                </div>
            <div><input type="button" value="帖子管理"class="title" id="menu2" onclick="showmenu('2')"/></div>
                <div id="list2" style="display:none">
                    <ul class="option">
                        <li><a href="#" id="cardselect">搜索帖子</a></li>
                        <li><a href="#" id="cardlist">帖子列表</a></li>
                        <li><a href="#">相关操作</a></li>
                    </ul>
                </div>
        <div><input type="button" value="版块管理"class="title" id="menu3" onclick="showmenu('3')"/></div>
        <div id="list3" style="display:none">
            <ul class="option">
                <li><a href="#">搜索版块</a></li>
                <li><a  id="clist" href="#">版块列表</a></li>
                <li><a href="#">相关操作</a></li>
            </ul>
        </div>
    </div>
    </div>
    <div id="footer">
        <div id="altnay">
            <a href="#">About</a> -
            <a href="#">Services</a> -
            <a href="#">Portfolio</a> -
            <a href="#">Contact Us</a> -
            <a href="#">Terms of US</a>
        </div>
        Copyright &copy;Enlighten Designs Powered by <a href="#">Enlighten Hosting</a> and <a href="#">Vadmin 3.0 CMS</a>
    </div>
</div>
</body>
</html>